---
import AuthLayout from "@/layouts/AuthLayout.astro";
import { LoginForm } from "@/components/auth/LoginForm";

export const prerender = false;

// Server-side session check - if user is already logged in, redirect to campaigns
// The middleware already sets Astro.locals.user if authenticated
if (Astro.locals.user) {
  const redirect = Astro.url.searchParams.get("redirect") || "/campaigns";
  return Astro.redirect(redirect);
}

const redirect = Astro.url.searchParams.get("redirect") || "/campaigns";
---

<AuthLayout title="Login - Initiative Forge">
  <LoginForm client:load redirect={redirect} />

  <p class="mt-6 text-center text-sm text-slate-400">
    Don't have an account?{" "}
    <a href="/auth/register" class="font-semibold text-blue-400 hover:text-blue-300 transition-colors">
      Register here
    </a>
  </p>
</AuthLayout>
